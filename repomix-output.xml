This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
backend/.env.example
backend/.python-version
backend/app/db.py
backend/app/deps/auth.py
backend/app/libs/firebase_admin.py
backend/app/main.py
backend/app/routers/favorites.py
backend/app/routers/recipes.py
backend/app/routers/user.py
backend/app/schemas/favorite.py
backend/app/services/chatgpt_service.py
backend/app/services/recipe_service.py
backend/docker-compose.yml
backend/prisma/schema.prisma
backend/prisma/seed_users.py
backend/README.md
backend/requirements.txt
frontend/.env.example
frontend/.eslintignore
frontend/.eslintrc.json
frontend/.prettierignore
frontend/.prettierrc
frontend/next.config.js
frontend/package.json
frontend/postcss.config.js
frontend/public/google-icon.svg
frontend/README.md
frontend/src/app/api/fetchRecipes.ts
frontend/src/app/favorites/[id]/page.tsx
frontend/src/app/favorites/page.tsx
frontend/src/app/globals.css
frontend/src/app/layout.tsx
frontend/src/app/login/page.tsx
frontend/src/app/page.tsx
frontend/src/components/GoogleLoginButton.tsx
frontend/src/components/LoginMenu.tsx
frontend/src/components/PopupMessage.tsx
frontend/src/components/RecipeForm.tsx
frontend/src/components/RecipeList.tsx
frontend/src/libs/firebase.ts
frontend/src/libs/signInWithGoogle.ts
frontend/src/services/user.ts
frontend/src/utils/auth.ts
frontend/tailwind.config.js
frontend/tsconfig.eslint.json
frontend/tsconfig.json
README.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="backend/app/db.py">
# app/db.py

from prisma import Prisma

prisma_client = Prisma()
</file>

<file path="backend/app/schemas/favorite.py">
# backend/app/schemas/favorite.py

from pydantic import BaseModel, Field

class FavoriteCreate(BaseModel):
    title: str = Field(..., max_length=50)
    content: str = Field(..., max_length=1000)
</file>

<file path="backend/app/services/recipe_service.py">
# backend/app/services/recipe_service.py

from app.db import prisma_client

async def get_all_recipes():
    recipes = await prisma_client.recipe.find_many()
    return recipes
</file>

<file path="frontend/.eslintignore">
node_modules
.next
dist
build
coverage
public
eslint.config.mjs
postcss.config.js
tailwind.config.js
</file>

<file path="frontend/.prettierignore">
node_modules
.next
dist
build
coverage
public
eslint.config.mjs
postcss.config.js
tailwind.config.js
</file>

<file path="frontend/.prettierrc">
{
  "semi": true,
  "singleQuote": true,
  "trailingComma": "es5",
  "printWidth": 80,
  "tabWidth": 2
}
</file>

<file path="frontend/postcss.config.js">
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};
</file>

<file path="frontend/public/google-icon.svg">
<?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg width="800px" height="800px" viewBox="-3 0 262 262" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid"><path d="M255.878 133.451c0-10.734-.871-18.567-2.756-26.69H130.55v48.448h71.947c-1.45 12.04-9.283 30.172-26.69 42.356l-.244 1.622 38.755 30.023 2.685.268c24.659-22.774 38.875-56.282 38.875-96.027" fill="#4285F4"/><path d="M130.55 261.1c35.248 0 64.839-11.605 86.453-31.622l-41.196-31.913c-11.024 7.688-25.82 13.055-45.257 13.055-34.523 0-63.824-22.773-74.269-54.25l-1.531.13-40.298 31.187-.527 1.465C35.393 231.798 79.49 261.1 130.55 261.1" fill="#34A853"/><path d="M56.281 156.37c-2.756-8.123-4.351-16.827-4.351-25.82 0-8.994 1.595-17.697 4.206-25.82l-.073-1.73L15.26 71.312l-1.335.635C5.077 89.644 0 109.517 0 130.55s5.077 40.905 13.925 58.602l42.356-32.782" fill="#FBBC05"/><path d="M130.55 50.479c24.514 0 41.05 10.589 50.479 19.438l36.844-35.974C195.245 12.91 165.798 0 130.55 0 79.49 0 35.393 29.301 13.925 71.947l42.211 32.783c10.59-31.477 39.891-54.251 74.414-54.251" fill="#EB4335"/></svg>
</file>

<file path="frontend/README.md">
# ãƒ¬ã‚·ãƒ”ã‚¢ãƒ—ãƒª ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

## ğŸ’» æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- Next.js
- TypeScript
- Tailwind CSS
- Firebase Authentication

## ğŸ”§ é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å¿…è¦æ¡ä»¶

- Node.js 18.xä»¥ä¸Š
- npm 9.xä»¥ä¸Š

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †

1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
cp .env.example .env.local
```

å¿…è¦ãªç’°å¢ƒå¤‰æ•°:

- `NEXT_PUBLIC_API_BASE_URL`
- `NEXT_PUBLIC_FIREBASE_CONFIG_*`

3. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
npm run dev
```

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

- `npm run dev`: é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
- `npm run build`: ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
- `npm run lint`: ESLintã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰æ¤œè¨¼
- `npm test`: ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/         # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ api/         # APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ components/  # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ libs/        # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåˆæœŸåŒ–ï¼ˆFirebaseç­‰ï¼‰
â”‚   â”œâ”€â”€ services/    # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â””â”€â”€ utils/       # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â””â”€â”€ public/          # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
```
</file>

<file path="frontend/src/app/favorites/[id]/page.tsx">
//ãŠæ°—ã«å…¥ã‚Šç·¨é›†ãƒšãƒ¼ã‚¸
'use client'

import { useEffect, useState } from 'react'
import { useParams, useRouter } from 'next/navigation'
import { getIdToken } from '@/utils/auth'
import LoginMenuButton from '@/components/LoginMenu'

type Favorite = {
  id: string
  title: string
  content: string
}

export default function EditFavoritePage() {
  const { id } = useParams<{ id: string }>()
  const router = useRouter()

  const [favorite, setFavorite] = useState<Favorite | null>(null)
  const [title, setTitle] = useState('')
  const [content, setContent] = useState('')
  const [loading, setLoading] = useState(true)
  const [submitting, setSubmitting] = useState(false)
  const [error, setError] = useState<string | null>(null)

  // ãŠæ°—ã«å…¥ã‚Š1ä»¶å–å¾—
  const fetchFavorite = async () => {
    try {
      setLoading(true)
      const token = await getIdToken()
      if (!token) throw new Error('èªè¨¼ãŒå¿…è¦ã§ã™')

      const res = await fetch('http://localhost:8000/api/favorites', {
        headers: {
          Authorization: `Bearer ${token}`,
        },
      })

      const data: Favorite[] = await res.json()
      const target = data.find((item) => item.id === id)

      if (!target) {
        throw new Error('ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ')
      }

      setFavorite(target)
      setTitle(target.title)
      setContent(target.content)
    } catch (err) {
      setError((err as Error).message)
    } finally {
      setLoading(false)
    }
  }

  useEffect(() => {
    fetchFavorite()
  }, [id])

  // æ›´æ–°å‡¦ç†
  const handleUpdate = async () => {
    setSubmitting(true)
    try {
      const token = await getIdToken()
      if (!token) throw new Error('èªè¨¼ãŒå¿…è¦ã§ã™')

      const res = await fetch(`http://localhost:8000/api/favorites/${id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`,
        },
        body: JSON.stringify({ title, content }),
      })

      if (!res.ok) throw new Error('æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ')

      router.push('/favorites')
    } catch (err) {
      setError((err as Error).message)
    } finally {
      setSubmitting(false)
    }
  }

  // å‰Šé™¤å‡¦ç†
  const handleDelete = async () => {
    if (!confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return

    const token = await getIdToken()
    if (!token) return

    await fetch(`http://localhost:8000/api/favorites/${id}`, {
      method: 'DELETE',
      headers: {
        Authorization: `Bearer ${token}`,
      },
    })

    router.push('/favorites')
  }

  return (
    <div className="min-h-screen bg-white font-sans p-8 flex flex-col items-center gap-6">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <div className="flex justify-between w-full max-w-3xl items-center">
        <h1 className="text-3xl font-bold text-[#443627]">ãŠæ°—ã«å…¥ã‚Šã‚’ç·¨é›†</h1>
        <LoginMenuButton />
      </div>

      {loading ? (
        <p className="text-gray-500">èª­ã¿è¾¼ã¿ä¸­...</p>
      ) : error ? (
        <p className="text-red-500">{error}</p>
      ) : (
        <div className="w-full max-w-3xl space-y-4">
          <input
            type="text"
            className="w-full px-4 py-2 border border-gray-300 rounded-md"
            value={title}
            onChange={(e) => setTitle(e.target.value)}
          />
          <textarea
            className="w-full px-4 py-2 border border-gray-300 rounded-md"
            value={content}
            onChange={(e) => setContent(e.target.value)}
          />
          <div className="flex gap-4">
            <button
              onClick={handleUpdate}
              disabled={submitting}
              className="bg-orange-400 hover:bg-orange-500 text-white px-4 py-2 rounded-md disabled:opacity-50"
            >
              {submitting ? 'ä¿å­˜ä¸­...' : 'æ›´æ–°ã™ã‚‹'}
            </button>
            <button
              onClick={handleDelete}
              className="bg-red-100 hover:bg-red-200 text-red-600 px-4 py-2 rounded-md"
            >
              å‰Šé™¤ã™ã‚‹
            </button>
          </div>
          <button
            onClick={() => router.push('/favorites')}
            className="text-sm text-gray-500 hover:underline mt-2"
          >
            ä¸€è¦§ã«æˆ»ã‚‹
          </button>
        </div>
      )}
    </div>
  )
}
</file>

<file path="frontend/tsconfig.eslint.json">
{
  "extends": "./tsconfig.json",
  "include": [
    "src/**/*",
    "next-env.d.ts",
    "next.config.ts",
    "*.js",
    "*.ts",
    "**/*.ts",
    "**/*.tsx"
  ],
  "exclude": ["node_modules"]
}
</file>

<file path="backend/.python-version">
3.11.12
</file>

<file path="backend/app/routers/user.py">
# å†…å®¹: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
from fastapi import APIRouter, Depends, HTTPException
from app.db import prisma_client
from app.deps.auth import get_current_user

router = APIRouter()


@router.get("/user")
async def get_current_user_profile(user=Depends(get_current_user)):
    db_user = await prisma_client.user.find_unique(where={"uid": user["uid"]})
    if not db_user:
        # ç™»éŒ²ã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
        raise HTTPException(status_code=403, detail="è¨±å¯ã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã™")
    return db_user
</file>

<file path="backend/README.md">
# ãƒ¬ã‚·ãƒ”ã‚¢ãƒ—ãƒª ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- FastAPI
- Prisma ORM
- PostgreSQL
- Firebase Admin SDK

## é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å¿…è¦æ¡ä»¶

- Python 3.11 ä»¥ä¸Š
- PostgreSQL 14 ä»¥ä¸Š
- pipenv

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †

1. ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆã—ã¦æœ‰åŠ¹åŒ–

```bash
python3.11.12 -m venv venv

# macOS/Linux
source venv/bin/activate
# Windows
venv\Scripts\activate
```

2. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pip install -r requirements.txt
```

3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
cp .env.example .env
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
```

4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èµ·å‹•

```bash
docker-compose up -d
```

5. Prisma ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
npx prisma migrate dev --name init

# 2. Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç”Ÿæˆ
prisma generate

# 3. åˆæœŸãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥
python prisma/seed.pyï¼ˆä¾‹ï¼‰
```

6. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•

```bash
uvicorn app.main:app --reload
```

### API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

<URL>

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ routers/    # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ deps/       # ä¾å­˜é–¢ä¿‚ï¼ˆèªè¨¼ç­‰ï¼‰
â”‚   â”œâ”€â”€ libs/       # å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”‚   â”œâ”€â”€ schemas/    # ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â””â”€â”€ services/   # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚
â”œâ”€â”€ prisma/         # Prismaã‚¹ã‚­ãƒ¼ãƒãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â””â”€â”€ venv/           # Pythonä»®æƒ³ç’°å¢ƒ
```

---
</file>

<file path="frontend/.env.example">
# ã€Œã²ãªå½¢ã€
# Firebase Config
NEXT_PUBLIC_FIREBASE_API_KEY=your_firebase_api_key
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your_project.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your_project_id
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your_project.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your_messaging_sender_id
NEXT_PUBLIC_FIREBASE_APP_ID=your_app_id

# API Base URL
NEXT_PUBLIC_API_BASE_URL=http://localhost:xxxx
</file>

<file path="frontend/.eslintrc.json">
{
  "env": {
    "browser": true,
    "es2022": true,
    "node": true
  },
  "extends": [
    "airbnb",
    "plugin:@typescript-eslint/recommended",
    "airbnb-typescript",
    "next/core-web-vitals",
    "plugin:prettier/recommended"
  ],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "project": "./tsconfig.eslint.json",
    "sourceType": "module"
  },
  "plugins": ["@typescript-eslint", "prettier", "import"],
  "rules": {
    "prettier/prettier": "error",
    "import/extensions": [
      "error",
      "ignorePackages",
      {
        "js": "never",
        "jsx": "never",
        "ts": "never",
        "tsx": "never"
      }
    ],
    "@typescript-eslint/no-unused-vars": ["error", { "argsIgnorePattern": "^_" }],
    "no-console": "warn"
  },
  "settings": {
    "import/resolver": {
      "node": {
        "extensions": [".js", ".jsx", ".ts", ".tsx"]
      },
      "typescript": {}
    }
  },
  "ignorePatterns": ["prettier.config.js"]
}
</file>

<file path="frontend/src/app/api/fetchRecipes.ts">
async function fetchRecipes(
  keyword: string
): Promise<{ title: string; instructions: string }[]> {
  const response = await fetch('http://localhost:8000/api/recipes', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ keyword }),
  });

  if (!response.ok) {
    throw new Error('ãƒ¬ã‚·ãƒ”å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }

  const data = await response.json();

  // â­ ã“ã“ã«å…¥ã‚Œã‚‹ï¼ï¼(æœ¬ç•ªã§ã¯å‰Šé™¤)
  console.log('API response:', data);

  // FastAPI å´ãŒ { recipes: [{ title, instructions }, ...] } ã‚’è¿”ã—ã¦ã„ã‚‹å ´åˆ
  return data.recipe;
}

export default fetchRecipes;
</file>

<file path="frontend/src/app/favorites/page.tsx">
//ä¸€è¦§ãƒšãƒ¼ã‚¸
'use client'

import { useEffect, useState } from 'react'
import { getIdToken } from '@/utils/auth'
import LoginMenuButton from '@/components/LoginMenu'

type Favorite = {
  id: string
  title: string
  content: string
}

export default function FavoritesPage() {
  const [favorites, setFavorites] = useState<Favorite[]>([])
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)

  const fetchFavorites = async () => {
    try {
      setLoading(true)
      setError(null)

      const token = await getIdToken()
      if (!token) {
        throw new Error('èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ãŒå–å¾—ã§ãã¾ã›ã‚“')
      }

      const res = await fetch('http://localhost:8000/api/favorites', {
        headers: {
          Authorization: `Bearer ${token}`,
        },
      })

      if (!res.ok) {
        throw new Error(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ (${res.status})`)
      }

      const data = await res.json()
      setFavorites(data)
    } catch (err) {
      setError((err as Error).message)
    } finally {
      setLoading(false)
    }
  }

  useEffect(() => {
    fetchFavorites()
  }, [])

  return (
    <div className="min-h-screen bg-white font-sans p-8 flex flex-col items-center gap-6">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <div className="flex justify-between w-full max-w-3xl items-center">
        <h1 className="text-3xl font-bold text-[#443627]">ãŠæ°—ã«å…¥ã‚Šä¸€è¦§</h1>
        <LoginMenuButton />
      </div>

      {loading && <p className="text-gray-500">èª­ã¿è¾¼ã¿ä¸­...</p>}
      {error && <p className="text-red-500">{error}</p>}

      {/* ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆ */}
      <div className="w-full max-w-3xl space-y-4">
        {favorites.length === 0 && !loading ? (
          <p className="text-gray-400 text-center">ãŠæ°—ã«å…¥ã‚Šã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
        ) : (
          favorites.map((fav) => (
            <div
              key={fav.id}
              className="border rounded-lg p-4 bg-white shadow-sm"
            >
              <h2 className="text-xl font-semibold text-[#443627]">{fav.title}</h2>
              <p className="text-gray-600 mt-1 whitespace-pre-wrap">{fav.content}</p>
            </div>
          ))
        )}
      </div>
    </div>
  )
}
</file>

<file path="frontend/src/components/PopupMessage.tsx">
'use client';

import { useEffect } from 'react';

type PopupMessageProps = {
  message: string;
  onClose: () => void;
  autoClose: boolean;
  autoCloseDelay: number;
};

export default function PopupMessage({
  message,
  onClose,
  autoClose = false,
  autoCloseDelay = 3000,
}: PopupMessageProps) {
  // è‡ªå‹•ã‚¯ãƒ­ãƒ¼ã‚ºå‡¦ç†
  useEffect(() => {
    if (autoClose && onClose) {
      const timer = setTimeout(onClose, autoCloseDelay);
      return () => clearTimeout(timer); // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    }
    return undefined; // ä½•ã‚‚ã—ãªã„å ´åˆã¯æ˜ç¤ºçš„ã«undefinedã‚’è¿”ã™
  }, [autoClose, autoCloseDelay, onClose]);

  return (
    <div className="fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center z-50">
      <div className="bg-white p-8 rounded shadow text-center">
        <p>{message}</p>
        {!autoClose && (
          <button
            onClick={onClose}
            className="mt-4 px-4 py-2 bg-blue-500 text-white rounded"
            type="button"
          >
            OK
          </button>
        )}
      </div>
    </div>
  );
}
</file>

<file path="frontend/src/libs/signInWithGoogle.ts">
import { signInWithPopup } from 'firebase/auth';
import { auth, googleProvider } from '@/libs/firebase';

// Googleãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã€‚ãƒ­ã‚°ã‚¤ãƒ³çµæœã‚’è¿”ã™
const signInWithGoogle = async () => {
  const result = await signInWithPopup(auth, googleProvider);
  return result;
};

export default signInWithGoogle;
</file>

<file path="frontend/src/services/user.ts">
import getIdToken from '@/utils/auth';

// èªè¨¼ä»˜ãã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹é–¢æ•°
export default async function fetchUser() {
  const idToken = await getIdToken();
  const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/user`, {
    headers: {
      Authorization: `Bearer ${idToken}`,
    },
  });
  if (!res.ok) throw new Error('èªè¨¼å¤±æ•—');
  return res.json(); // return await ã‚’ return ã ã‘ã«ä¿®æ­£
}
</file>

<file path="frontend/tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "types": ["vitest/globals", "node"],
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules", ".next"]
}
</file>

<file path="README.md">
# ãƒ¬ã‚·ãƒ”ç®¡ç†ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

## æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€AI ã‚’æ´»ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å†·è”µåº«ã®é£Ÿæã‹ã‚‰ãƒ¬ã‚·ãƒ”ã‚’ææ¡ˆã—ã€ãŠæ°—ã«å…¥ã‚Šã®ãƒ¬ã‚·ãƒ”ã‚’ç®¡ç†ãƒ»å…±æœ‰ã§ãã‚‹ Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

## ğŸŒŸ å®Ÿè£…æ©Ÿèƒ½ä¸€è¦§ï¼ˆMVPï¼‰

1. ğŸ§‚ **ãƒ¬ã‚·ãƒ”ææ¡ˆæ©Ÿèƒ½**

   - ææ–™ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ChatGPT ãŒæœ€é©ãªãƒ¬ã‚·ãƒ”ã‚’ææ¡ˆ
   - å­£ç¯€ã‚„èª¿ç†æ™‚é–“ã‚’è€ƒæ…®ã—ãŸãƒ¬ã‚·ãƒ”ç”Ÿæˆ

2. ğŸ‘¤ **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½**
   - Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ç°¡å˜ãƒ­ã‚°ã‚¤ãƒ³
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ç®¡ç†
3. â­ **ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½**
   - æ°—ã«å…¥ã£ãŸãƒ¬ã‚·ãƒ”ã®ä¿å­˜
   - ãŠæ°—ã«å…¥ã‚Šãƒ¬ã‚·ãƒ”ã®ä¸€è¦§è¡¨ç¤ºã¨æ¤œç´¢
   - ãƒ¬ã‚·ãƒ”ã®ç·¨é›†ã¨å‰Šé™¤

## ğŸ’» æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

- Next.js 13 (App Router)
- TypeScript 5.3
- Tailwind CSS 3.4
- Firebase Authentication

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

- FastAPI 0.104
- Python 3.11
- Prisma Client Python
- Firebase Admin SDK

### ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹

- PostgreSQL 14
- Docker / docker-compose
- OpenAI API (GPT-4)
- Firebase Authentication

## ğŸ“‚ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
section7_teamB/
â”œâ”€â”€ frontend/     # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ backend/      # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API
â””â”€â”€ docs/         # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

## ğŸ”§ é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone https://github.com/ms-engineer-bc25-04/section7_teamB.git
cd section7_teamB
```

2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

- `.env.example`ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦`.env`ã‚’ä½œæˆ
- å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®èµ·å‹•

- è©³ç´°ã¯å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® README ã‚’å‚ç…§

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License
</file>

<file path="backend/app/deps/auth.py">
"""Authentication dependency module."""  # C0114å¯¾ç­–
# Firebase ã® ID ãƒˆãƒ¼ã‚¯ãƒ³èªè¨¼ç”¨ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
# APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰IDãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŠ½å‡ºã—æ¤œè¨¼ã™ã‚‹

from fastapi import HTTPException, Security
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from app.libs.firebase_admin import initialize_firebase
from firebase_admin import auth as firebase_auth

# Bearerèªè¨¼ã®ã‚¹ã‚­ãƒ¼ãƒã‚’è¨­å®š
security = HTTPBearer()

async def get_current_user(token: HTTPAuthorizationCredentials = Security(security)):
    """
    Firebase ã® ID ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã—ã€èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆãƒ‡ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã‚’è¿”ã™
    """
    try:
        print("å—ã‘å–ã£ãŸãƒˆãƒ¼ã‚¯ãƒ³:", token.credentials)  # è¿½åŠ 
        # Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŠ½å‡ºã—ã€Firebaseã§æ¤œè¨¼
        decoded_token = firebase_auth.verify_id_token(token.credentials)
        print("ãƒ‡ã‚³ãƒ¼ãƒ‰å¾Œ:", decoded_token)  # è¿½åŠ 
        return decoded_token
    except Exception as e:
        print("èªè¨¼ã‚¨ãƒ©ãƒ¼:", e)
        raise HTTPException(status_code=401, detail="èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ")
</file>

<file path="backend/app/libs/firebase_admin.py">
"""Firebase Admin SDK initialization helper module."""  # C0114å¯¾ç­–
# Firebase Admin SDK ã®åˆæœŸåŒ–

import os
from pathlib import Path
import firebase_admin
from firebase_admin import credentials
from fastapi import HTTPException


def initialize_firebase():
    """Initialize Firebase Admin SDK if not already initialized."""  # C0116å¯¾ç­–
    # ãƒ†ã‚¹ãƒˆä¸­ã¯ Firebase åˆæœŸåŒ–ã‚’ã‚¹ã‚­ãƒƒãƒ—
    if os.getenv("TESTING") == "1":
        print("[INFO] Skipping Firebase initialization (TESTING mode)")
        return

    try:
        # ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®ãƒ‘ã‚¹ã‚’ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—
        cred_path = os.environ.get(
            "FIREBASE_ADMIN_KEY_PATH", "./serviceAccountKey.json"
        )
        if not Path(cred_path).exists():
            raise FileNotFoundError(
                f"Firebase credentials file not found at {cred_path}"
            )

        # Firebaseã‚¢ãƒ—ãƒªãŒæœªåˆæœŸåŒ–ãªã‚‰åˆæœŸåŒ–ã™ã‚‹
        if not firebase_admin._apps:
            cred = credentials.Certificate(cred_path)
            firebase_admin.initialize_app(cred)
    except Exception as e:
        raise HTTPException(
            status_code=500, detail=f"Firebase initialization failed: {str(e)}"
        )


# FastAPIã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«å‘¼ã³å‡ºã—
initialize_firebase()
</file>

<file path="backend/app/routers/recipes.py">
from fastapi import APIRouter
from pydantic import BaseModel
from app.services import chatgpt_service

router = APIRouter()

# ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®Bodyç”¨ã®Schema
class RecipeRequest(BaseModel):
    keyword: str

# POST /api/recipes
@router.post("")
async def create_recipe(request: RecipeRequest):
    keyword = request.keyword
    # await ã‚’å¤–ã™ â†’ åŒæœŸé–¢æ•°ã ã‹ã‚‰
    recipe = chatgpt_service.get_recipe_from_chatgpt(keyword)
    return {"recipe": recipe}
</file>

<file path="backend/app/services/chatgpt_service.py">
import os
import openai

# OpenAI APIã‚­ãƒ¼ã‚’ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—
openai.api_key = os.getenv("OPENAI_API_KEY")

# ChatGPT ã‹ã‚‰ãƒ¬ã‚·ãƒ”ã‚’å–å¾—ã™ã‚‹é–¢æ•°
def get_recipe_from_chatgpt(keyword: str) -> list:
    prompt = f"""
    ã‚ãªãŸã¯ãƒ—ãƒ­ã®æ–™ç†ç ”ç©¶å®¶ã§ã™ã€‚
    æ¬¡ã®ææ–™ã€Œ{keyword}ã€ã‚’ä½¿ã£ãŸæ–™ç†ã‚’2ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚
    ä»¥ä¸‹ã®å½¢å¼ã§ã€å¿…ãš **JSONå½¢å¼** ã§è¿”ã—ã¦ãã ã•ã„ï¼ˆæ–‡ç« ã¯ä¸è¦ã§ã™ï¼‰ï¼š
    "instructions" ã¯ **å„æ‰‹é †ã‚’æ”¹è¡Œï¼ˆ\\nï¼‰ã§åŒºåˆ‡ã£ã¦ãã ã•ã„**ã€‚

    {{
        "recipes": [
        {{
            "title": "ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«1",
            "instructions": "1. æ‰‹é †1\\n2. æ‰‹é †2\\n3. æ‰‹é †3"
        }},
        {{
            "title": "ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«2",
            "instructions": "1. æ‰‹é †1\\n2. æ‰‹é †2\\n3. æ‰‹é †3"
        }}
        ]
    }}
    """

    response = openai.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "user", "content": prompt}
        ],
        max_tokens=500,
        temperature=0.7,
    )

    # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ content ã‚’å–ã‚Šå‡ºã™
    recipe_text = response.choices[0].message.content

    # JSONéƒ¨åˆ†ã‚’è¾æ›¸ã«å¤‰æ›
    import json
    try:
        recipe_json = json.loads(recipe_text)
        return recipe_json["recipes"]
    except Exception as e:
        print("JSON parse error:", e)
        print("Response was:", recipe_text)
        # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ç©ºãƒªã‚¹ãƒˆã‚’è¿”ã™
        return []
</file>

<file path="backend/prisma/seed_users.py">
import asyncio
from prisma import Prisma
from prisma.types import UserCreateInput

USERS = [
    UserCreateInput(
        uid="LGr43wiqwqXN0rcy6nmbFaQpWiz2",
        email="takaeshiobara@gmail.com",
        name="takae",
    ),
    UserCreateInput(
        uid="QAUq4FlFB6deuhVMRD77btxZ4zz1", 
        email="r15.zzz0415@gmail.com",   
        name="noriko",
    ),
]


async def main():
    db = Prisma()
    await db.connect()
    for user in USERS:
        # uidãŒé‡è¤‡ã—ãªã„ã‚ˆã†ã«ãƒã‚§ãƒƒã‚¯
        exists = await db.user.find_unique(where={"uid": user["uid"]})
        if not exists:
            await db.user.create(data=user)
    await db.disconnect()


if __name__ == "__main__":
    asyncio.run(main())
</file>

<file path="frontend/src/app/globals.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --color-primary: #393E46;
  --color-button-white: #FFFFFF;
  --color-button-orange: #FF9D23;
  --color-title: #443627;
  --color-text: #393E46;
  --color-background: #FFFFFF;
}

body {
  @apply bg-background text-text font-sans;
}
</file>

<file path="frontend/src/app/layout.tsx">
import type { Metadata } from 'next';
import './globals.css';
import { Toaster } from 'react-hot-toast';

// Tailwindã®font-sansã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€Google Fontsã®è¨­å®šã¯å‰Šé™¤ã—ã¾ã—ãŸ

export const metadata: Metadata = {
  title: 'ãƒ¬ã‚·ãƒ”ææ¡ˆã‚¢ãƒ—ãƒª', // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã‚’è¨­å®š
  description: 'ã‚ãªãŸã®å†·è”µåº«ã®é£Ÿæã‹ã‚‰ç°¡å˜ãƒ¬ã‚·ãƒ”ã‚’ææ¡ˆã™ã‚‹Webã‚¢ãƒ—ãƒª', // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜ã‚’è¨­å®š
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="ja">
      <body
        className="font-sans antialiased" // Tailwindã®ãƒ•ã‚©ãƒ³ãƒˆã¨ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆæ–‡å­—ã‚„ç”»åƒã®ç¸ã‚’ãªã‚ã‚‰ã‹ã«è£œæ­£ã™ã‚‹æŠ€è¡“ï¼‰ã‚’é©ç”¨
      >
        <Toaster />
        {children}
      </body>
    </html>
  );
}
</file>

<file path="frontend/src/components/LoginMenu.tsx">
import { useState, useRef, useEffect } from 'react';
import { useAuthState } from 'react-firebase-hooks/auth';
import { auth } from '@/libs/firebase';
import { useRouter } from 'next/navigation';
import toast from 'react-hot-toast';

export default function LoginMenuButton() {
  const [user] = useAuthState(auth);
  const [open, setOpen] = useState(false);
  const router = useRouter();

  // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”¨ã®ref
  const menuRef = useRef<HTMLDivElement>(null);

  // å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’é–‰ã˜ã‚‹
  useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {
        setOpen(false);
      }
    }
    if (open) {
      document.addEventListener('mousedown', handleClickOutside);
    }
    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [open]);

  // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
  const handleLogout = async () => {
    await auth.signOut();
    toast.success('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸï¼');
    setTimeout(() => {
      router.push('/');
    }, 700);
  };

  if (!user) {
    // æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯ã€Œãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ï¼ˆã‚„ã‚ã‚‰ã‹ã„ã‚ªãƒ¬ãƒ³ã‚¸ãƒ»ä¸¸ã¿ï¼‰
    return (
      <button
        type="button" // æ˜ç¤ºçš„ã«typeã‚’æŒ‡å®šï¼ˆformèª¤å‹•ä½œé˜²æ­¢ï¼‰
        onClick={() => router.push('/login')}
        className="px-4 py-2 rounded-full bg-orange-400 text-white font-semibold hover:bg-orange-500 transition"
        style={{ boxShadow: '0 1px 3px #f2e3c6' }}
      >
        ãƒ­ã‚°ã‚¤ãƒ³
      </button>
    );
  }

  // ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯ä¸¸ã„å…±é€šã‚¢ã‚¤ã‚³ãƒ³ï¼‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼
  return (
    <div className="relative">
      <button
        type="button" // æ˜ç¤ºçš„ã«typeã‚’æŒ‡å®šï¼ˆformèª¤å‹•ä½œé˜²æ­¢ï¼‰
        onClick={() => setOpen((v) => !v)}
        className="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center hover:bg-orange-200 transition relative"
        title="ãƒ­ã‚°ã‚¤ãƒ³ä¸­"
        style={{ border: '2px solid #f59e42' }}
      >
        {/* å…±é€šã®äººå‹ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆSVGï¼‰ */}
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="12" fill="#F9D7A0" />
          <path
            d="M12 13c2.7 0 4.5 1.2 4.5 2.3v1.2H7.5v-1.2C7.5 14.2 9.3 13 12 13Zm0-1.5a2.25 2.25 0 1 0 0-4.5 2.25 2.25 0 0 0 0 4.5Z"
            fill="#F59E42"
          />
        </svg>
        {/* ç·‘ã®å°ã•ã„ãƒãƒƒã‚¸ */}
        <span className="absolute right-0 bottom-0 block w-3 h-3 rounded-full bg-green-400 border-2 border-white" />
      </button>
      {/* ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */}
      {open && (
        <div className="absolute right-0 mt-2 w-40 bg-white rounded-lg border border-orange-200 shadow-md z-50">
          <button
            type="button"
            className="block w-full px-4 py-2 hover:bg-orange-50 text-left text-gray-700"
            onClick={() => {
              setOpen(false);
              router.push('/');
            }}
          >
            ãƒˆãƒƒãƒ—
          </button>
          <button
            type="button"
            className="block w-full px-4 py-2 hover:bg-orange-50 text-left text-gray-700"
            onClick={() => {
              setOpen(false);
              router.push('/favorites');
            }}
          >
            ãŠæ°—ã«å…¥ã‚Š
          </button>
          <button
            type="button"
            className="block w-full px-4 py-2 hover:bg-orange-100 text-left text-orange-500"
            onClick={handleLogout}
          >
            ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
          </button>
        </div>
      )}
    </div>
  );
}
</file>

<file path="frontend/src/components/RecipeForm.tsx">
'use client';

import { useState } from 'react';

type RecipeFormProps = {
  onSearch: (ingredients: string[]) => void;
};

export default function RecipeForm({ onSearch }: RecipeFormProps) {
  const [ingredient1, setIngredient1] = useState('');
  const [ingredient2, setIngredient2] = useState('');
  const [ingredient3, setIngredient3] = useState('');

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    onSearch([ingredient1, ingredient2, ingredient3]);
  };

  return (
    <form
      onSubmit={handleSubmit}
      className="mb-4 flex flex-col gap-2 items-center"
    >
      {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤ºã™ã‚‹ãƒ©ãƒ™ãƒ«ã¯1ã¤ã ã‘ */}
      <label htmlFor="ingredient1" className="text-[#443627] font-bold">
        ğŸ“ é£Ÿæã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
        <input
          id="ingredient1"
          type="text"
          value={ingredient1}
          onChange={(e) => setIngredient1(e.target.value)}
          placeholder="é£Ÿæ1"
          className="border p-2 rounded text-[#393E46] w-64"
        />
      </label>
      {/* ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œï¼ˆè¦‹ãŸç›®ã¯éè¡¨ç¤ºã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼ã®ã¿èª­ã¾ã‚Œã‚‹ï¼‰ */}
      <label htmlFor="ingredient2" className="sr-only">
        é£Ÿæ2ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
        <input
          id="ingredient2"
          type="text"
          value={ingredient2}
          onChange={(e) => setIngredient2(e.target.value)}
          placeholder="é£Ÿæ2"
          className="border p-2 rounded text-[#393E46] w-64"
        />
      </label>
      <label htmlFor="ingredient3" className="sr-only">
        é£Ÿæ3ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
        <input
          id="ingredient3"
          type="text"
          value={ingredient3}
          onChange={(e) => setIngredient3(e.target.value)}
          placeholder="é£Ÿæ3"
          className="border p-2 rounded text-[#393E46] w-64"
        />
      </label>
      <button
        type="submit"
        className="bg-[#FF9D23] text-white px-4 py-2 rounded hover:bg-orange-400 mt-2"
      >
        ãƒ¬ã‚·ãƒ”ã‚’ææ¡ˆã™ã‚‹
      </button>
    </form>
  );
}
</file>

<file path="frontend/src/components/RecipeList.tsx">
// src/components/RecipeList.tsx

type Recipe = {
  title: string;
  instructions: string;
};

type RecipeListProps = {
  recipes: Recipe[];
  addFavorite: (recipe: Recipe) => void;
  isSubmitting: boolean;
};

export default function RecipeList({
  recipes,
  addFavorite,
  isSubmitting,
}: RecipeListProps) {
  if (recipes.length === 0) {
    return <p>ãƒ¬ã‚·ãƒ”ã¯ã¾ã è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>;
  }

return (
    <div className="flex flex-col gap-4">
      {recipes.map((recipe, index) => (
        <div
          key={index}
          className="border p-4 rounded bg-white shadow flex flex-col gap-2"
        >
          <div className="flex items-center gap-2">
            <span>ğŸ”</span>
            <h2 className="text-lg font-bold text-[#443627]">{recipe.title}</h2>
          </div>
          {/* ã“ã“ã‚’ preã‚¿ã‚°ã«ã™ã‚‹ï¼ */}
          <pre className="whitespace-pre-wrap text-left text-[#393E46]">{recipe.instructions}</pre>
          
           <button
            onClick={() => addFavorite(recipe)}
            disabled={isSubmitting}
            className="mt-2 px-4 py-2 border text-[#FF9D23] border-[#FF9D23] rounded transition hover:bg-[#FFF3E0] disabled:opacity-50"
          >
            {isSubmitting ? 'ç™»éŒ²ä¸­...' : 'â˜… ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ '}
          </button>

        </div>
      ))}
    </div>
  );
}
</file>

<file path="frontend/tailwind.config.js">
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    './src/**/*.{js,ts,jsx,tsx}',
  ],
  theme: {
    extend: {
      colors: {
        primary: 'var(--color-primary)',
        button: {
          white: 'var(--color-button-white)',
          orange: 'var(--color-button-orange)',
        },
        title: 'var(--color-title)', // ã‚¿ã‚¤ãƒˆãƒ«ç”¨ èŒ¶è‰²
        text: 'var(--color-text)', // ãƒ†ã‚­ã‚¹ãƒˆç”¨ ç°é»’è‰²
        background: 'var(--color-background)', // èƒŒæ™¯ç”¨ãƒ›ãƒ¯ã‚¤ãƒˆ
      },
      fontFamily: {
        // æ—¥æœ¬èªå¯¾å¿œãƒ•ã‚©ãƒ³ãƒˆ
        sans: ['"Yu Gothic Medium"', 'sans-serif'],
      },
    },
  },
  plugins: [],
};
</file>

<file path="backend/.env.example">
# ã€Œã²ãªå½¢ã€
DATABASE_URL=postgresql://postgres:password@db:5432/myapp_db
OPENAI_API_KEY=your_openai_api_key
FIREBASE_PROJECT_ID=your_project_id
ALLOWED_ORIGINS=http://localhost:xxxx
</file>

<file path="backend/requirements.txt">
# FastAPI æœ¬ä½“
fastapi==0.104.10

# ASGI ã‚µãƒ¼ãƒãƒ¼ï¼ˆé–‹ç™ºç”¨ï¼‰
uvicorn[standard]==0.24.0


# ç’°å¢ƒå¤‰æ•°ç®¡ç†
python-dotenv==1.0.0

# OpenAI API ç”¨
openai==1.3.5

# Firebase èªè¨¼
firebase-admin==6.2.0

# Prisma Python Clientï¼ˆPrismaå°å…¥æ¸ˆã¿å‰æï¼‰
prisma==0.11.0

# ãƒ†ã‚¹ãƒˆç³»
pytest==7.4.0
pytest-asyncio==0.21.1
httpx==0.25.0

fastapi
uvicorn[standard]
python-dotenv
prisma
</file>

<file path="frontend/next.config.js">
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
};

module.exports = nextConfig;
</file>

<file path="frontend/src/libs/firebase.ts">
// Firebaseé–¢é€£ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import { initializeApp, getApps } from 'firebase/app'; // Firebaseã‚¢ãƒ—ãƒªã®åˆæœŸåŒ–ãƒ»å–å¾—
import { getAuth, GoogleAuthProvider } from 'firebase/auth'; // èªè¨¼é–¢é€£ã®é–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹

// Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šæƒ…å ±ï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ï¼‰
const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY ?? '',
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN ?? '',
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID ?? '',
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET ?? '',
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID ?? '',
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID ?? '',
};

// Firebaseã‚¢ãƒ—ãƒªã®åˆæœŸåŒ–ï¼ˆã™ã§ã«åˆæœŸåŒ–æ¸ˆã¿ã®å ´åˆã¯å†åˆ©ç”¨ï¼‰
// ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚„HotReloadæ™‚ã®äºŒé‡åˆæœŸåŒ–ã‚’é˜²ããŸã‚ã®å®Ÿè£…
const app = !getApps().length
  ? initializeApp(firebaseConfig) // ã¾ã åˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã‘ã‚Œã°åˆæœŸåŒ–
  : getApps()[0]; // æ—¢å­˜ã®appã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã†

// Firebaseèªè¨¼æ©Ÿèƒ½ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—ãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
export const auth = getAuth(app);

// Googleèªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ä½œæˆãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
export const googleProvider = new GoogleAuthProvider();
// Googleãƒ­ã‚°ã‚¤ãƒ³æ™‚ã€æ¯å›ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®š
googleProvider.setCustomParameters({ prompt: 'select_account' });

// åˆæœŸåŒ–ã—ãŸFirebaseã‚¢ãƒ—ãƒªã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
export default app;
</file>

<file path="frontend/src/utils/auth.ts">
import { auth } from '@/libs/firebase';

// Firebaseã®IDãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
export default async function getIdToken(): Promise<string | null> {
  const user = auth.currentUser;
  if (!user) {
    console.warn(
      'Firebaseãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚'
    );
    return null;
  }
  return user.getIdToken();
}
</file>

<file path=".gitignore">
# Dependencies
**/node_modules/
**/venv/
**/.venv/

# Environment
**/.env
**/.env.*
!**/.env.example

# Python
**/__pycache__/
**/*.py[cod]
**/*.so

# Database
**/db-data/
**/prisma/migrations/
**/generated/prisma
**/*.sqlite
**/*.db

# Build outputs
**/.next/
**/build/
**/dist/

# Firebase
**/serviceAccountKey.json

# typescript
**/*.tsbuildinfo
**/next-env.d.ts

# IDE
.vscode/
**/.vscode/

# OS generated
.DS_Store
**/.DS_Store
*.pem
Thumbs.db

# Testing
coverage/
.coverage
htmlcov/
</file>

<file path="backend/prisma/schema.prisma">
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-py"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(cuid())
  uid       String     @unique
  email     String     @unique
  name      String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  favorites Favorite[] @relation("UserFavorites")

  @@map("users")
}

model Favorite {
  id        String   @id @default(cuid())
  title     String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userUid   String
  user      User     @relation("UserFavorites", fields: [userUid], references: [uid], onDelete: Cascade)

  @@map("favorites")
}
</file>

<file path="backend/app/routers/favorites.py">
"""Favorites router module"""  # C0114å¯¾ç­–
from fastapi import APIRouter, HTTPException, Path, Body, Depends
from pydantic import BaseModel
from app.db import prisma_client
from app.deps.auth import get_current_user


router = APIRouter()


# ãŠæ°—ã«å…¥ã‚Šæ–°è¦ç™»éŒ²æ™‚ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£
class FavoriteCreateRequest(BaseModel):
    """Request model for creating favorite"""  # C0115å¯¾ç­–
    title: str
    content: str


# ãŠæ°—ã«å…¥ã‚Šæ›´æ–°æ™‚ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£
class FavoriteUpdateRequest(BaseModel):
    """Request model for updating favorite"""  # C0115å¯¾ç­–
    title: str
    content: str


# èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŠæ°—ã«å…¥ã‚Šä¸€è¦§å–å¾—
@router.get("")
async def read_favorites(user=Depends(get_current_user)):
    """Get the list of favorites for the authenticated user"""  # C0116å¯¾ç­–
    # uidã§çµã‚‹
    favorites = await prisma_client.favorite.find_many(where={"userUid": user["uid"]})
    return favorites


# èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŠæ°—ã«å…¥ã‚Šã‚’æ–°è¦ç™»éŒ² (POST)
@router.post("")
async def create_favorite(
    favorite_data: FavoriteCreateRequest = Body(...),
    user=Depends(get_current_user),
):
    """Create a new favorite for the authenticated user"""  # C0116å¯¾ç­–
    # ã‚¿ã‚¤ãƒˆãƒ«ã ã‘ã§é‡è¤‡ãƒã‚§ãƒƒã‚¯
    existing_favorite = await prisma_client.favorite.find_first(
        where={
            "userUid": user["uid"],
            "title": favorite_data.title,
            }
        )
    if existing_favorite:
        raise HTTPException(status_code=409, detail="Duplicate favorite")

    # æ–°è¦ç™»éŒ²
    created_favorite = await prisma_client.favorite.create(
        data={
            "title": favorite_data.title,
            "content": favorite_data.content,
            "userUid": user["uid"],  # â† èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®uidã‚’ã‚»ãƒƒãƒˆ
            }
        )
    return created_favorite


# èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŠæ°—ã«å…¥ã‚Šã‚’æ›´æ–° (PUT)
@router.put("/{favorite_id}")
async def update_favorite(
     favorite_id: str = Path(..., description="ç·¨é›†ã™ã‚‹ãŠæ°—ã«å…¥ã‚Šã®ID"),
     favorite_data: FavoriteUpdateRequest = Body(...),
     user=Depends(get_current_user),
     ):
    """Update an existing favorite"""  # C0116å¯¾ç­–
    # è©²å½“IDï¼‹è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿
    favorite = await prisma_client.favorite.find_unique(where={"id": favorite_id})
    if not favorite or favorite.userUid != user["uid"]:
        raise HTTPException(status_code=404, detail="Favorite not found or not yours")

    # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
    return await prisma_client.favorite.update(
        where={"id": favorite_id},
        data={"title": favorite_data.title, "content": favorite_data.content},
        )


# èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŠæ°—ã«å…¥ã‚Šã‚’å‰Šé™¤(delete)
@router.delete("/{favorite_id}")
async def delete_favorite(
    favorite_id: str = Path(..., description="å‰Šé™¤ã™ã‚‹ãŠæ°—ã«å…¥ã‚Šã®ID"),
    user = Depends(get_current_user),
):
    """Delete an existing favorite"""  # C0116å¯¾ç­–
    _ = user  # W0613å¯¾ç­– â†’ ãƒ€ãƒŸãƒ¼ã§ã€Œä½¿ã£ãŸã€æ‰±ã„ã«ã™ã‚‹
    favorite = await prisma_client.favorite.find_unique(where={"id": favorite_id})
    if not favorite:
        raise HTTPException(status_code=404, detail="Favorite not found")
    await prisma_client.favorite.delete(where={"id": favorite_id})
    return {"message": "Favorite deleted successfully"}
</file>

<file path="backend/docker-compose.yml">
version: '3.8'
services:
  postgres:
    image: postgres:14
    container_name: myapp_postgres
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: myapp_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
</file>

<file path="frontend/src/components/GoogleLoginButton.tsx">
import { useState } from 'react';
import { auth, googleProvider } from '@/libs/firebase';
import { signInWithPopup } from 'firebase/auth';
import { useRouter } from 'next/navigation';
import Image from 'next/image';
import toast from 'react-hot-toast';

export default function GoogleLoginButton() {
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null); // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºç”¨state
  const router = useRouter();

  const handleLogin = async () => {
    setIsLoading(true);
    setError(null); // å‰ã®ã‚¨ãƒ©ãƒ¼ã‚’ã‚¯ãƒªã‚¢
    try {
      // Googleèªè¨¼ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
      const result = await signInWithPopup(auth, googleProvider);
      // Firebase IDãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
      const idToken = await result.user.getIdToken();
      // /api/user ã«èªè¨¼ä»˜ãã§ã‚¢ã‚¯ã‚»ã‚¹
      const baseUrl = process.env.NEXT_PUBLIC_API_BASE_URL;
      const res = await fetch(`${baseUrl}/user`, {
        headers: {
          Authorization: `Bearer ${idToken}`,
        },
      });

      if (res.ok) {
        toast.success('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼');
        setTimeout(() => {
          router.push('/favorites');
        }, 700);
      } else {
        const err = await res.json();
        setError(`èªè¨¼ã‚¨ãƒ©ãƒ¼: ${err.detail}`); // ã“ã“ã§ã‚¨ãƒ©ãƒ¼stateã«ã‚»ãƒƒãƒˆ
      }
    } catch (err) {
      setError('Googleãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <>
      {/* ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°ãƒœã‚¿ãƒ³ä¸Šéƒ¨ã«è¡¨ç¤º */}
      {error && (
        <div className="mb-2 text-red-600 bg-red-50 border border-red-300 rounded p-2">
          {error}
        </div>
      )}
      <button
        type="button"
        onClick={handleLogin}
        disabled={isLoading}
        className="flex items-center justify-center gap-2 w-64 py-3 px-6 rounded-full bg-orange-400 hover:bg-orange-500 text-white text-base font-semibold transition shadow mb-2"
        style={{ boxShadow: '0 1px 3px #f2e3c6' }}
      >
        {isLoading ? (
          <span>ãƒ­ã‚°ã‚¤ãƒ³ä¸­...</span>
        ) : (
          <>
            <Image src="/google-icon.svg" alt="Google" width={24} height={24} />
            <span>Googleã§ãƒ­ã‚°ã‚¤ãƒ³</span>
          </>
        )}
      </button>
    </>
  );
}
</file>

<file path="backend/app/main.py">
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from dotenv import load_dotenv
import os



# ãƒ«ãƒ¼ã‚¿ãƒ¼ã® import
from app.routers import recipes, favorites, user

# Prisma Client ã‚’ä½¿ã†ãŸã‚ã® import
from app.db import prisma_client

# .envãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€
load_dotenv()

# FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆ
app = FastAPI(title="Recipe App API", version="1.0.0")

# CORSè¨­å®šï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®Next.jsãªã©ã¨é€£æºã™ã‚‹ãŸã‚ï¼‰
origins = os.getenv("ALLOWED_ORIGINS", "").split(",")
app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,  # è¨±å¯ã™ã‚‹ã‚ªãƒªã‚¸ãƒ³
    allow_credentials=True,
    allow_methods=["*"],  # å…¨ãƒ¡ã‚½ãƒƒãƒ‰è¨±å¯
    allow_headers=["*"],  # å…¨ãƒ˜ãƒƒãƒ€ãƒ¼è¨±å¯
)


# Prisma Client ã®æ¥ç¶šãƒ»åˆ‡æ–­ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
@app.on_event("startup")
async def startup():
    await prisma_client.connect()


@app.on_event("shutdown")
async def shutdown():
    await prisma_client.disconnect()


# ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ç™»éŒ²
app.include_router(favorites.router, prefix="/api/favorites", tags=["favorites"])
app.include_router(recipes.router, prefix="/api/recipes", tags=["recipes"])
app.include_router(user.router, prefix="/api", tags=["user"])


# ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹
@app.get("/")
async def root():
    return {"message": "Recipe App API"}


# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯API
@app.get("/health")
async def health_check():
    return {"status": "healthy"}
</file>

<file path="frontend/src/app/login/page.tsx">
'use client';

import Image from 'next/image';
import GoogleLoginButton from '@/components/GoogleLoginButton';

export default function LoginPage() {
  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-orange-50 px-2">
      <div className="w-full max-w-[350px] sm:max-w-[400px] bg-white rounded-2xl shadow-md border border-orange-100 py-10 px-4 flex flex-col items-center">
        <h1 className="text-2xl font-bold text-gray-800 mb-5">ãƒ­ã‚°ã‚¤ãƒ³</h1>
        {/* ã‚¤ãƒ©ã‚¹ãƒˆ */}
        <Image
          src="/login-illustration.png"
          alt="ãƒ­ã‚°ã‚¤ãƒ³ã‚¤ãƒ©ã‚¹ãƒˆ"
          width={140}
          height={140}
          className="mx-auto mb-8"
          style={{ width: 140, height: 140 }}
        />
        <GoogleLoginButton />
      </div>
    </div>
  );
}
</file>

<file path="frontend/src/app/page.tsx">
'use client';

import { useState } from 'react';
import { fetchRecipes } from './api/fetchRecipes';
import RecipeForm from '../components/RecipeForm';
import RecipeList from '../components/RecipeList';
import LoginMenuButton from '../components/LoginMenu';
import { getAuth } from 'firebase/auth';
import { useRouter } from 'next/navigation';
import PopupMessage from '../components/PopupMessage';

type Recipe = {
  title: string;
  instructions: string;
};

export default function Home() {
  const [recipes, setRecipes] = useState<Recipe[]>([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [isSubmitting, setIsSubmitting] = useState(false);

// ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ç”¨ state
  const [popupMessage, setPopupMessage] = useState<string | null>(null);
  const [autoClose, setAutoClose] = useState(true);
  const router = useRouter();

// ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—é–‰ã˜ã‚‹é–¢æ•°
  const closePopup = () => {
    setPopupMessage(null);
  };

  const handleSearch = async (ingredients: string[]) => {
    try {
      setLoading(true);
      setError(null);
      
      const result = await fetchRecipes(ingredients.join(', '));
      
      setRecipes(result);
    } catch (err) {
      setError((err as Error).message);
    } finally {
      setLoading(false);
    }
  };

  // ãŠæ°—ã«å…¥ã‚Šç™»éŒ²ç”¨é–¢æ•°ï¼ˆèªè¨¼ä»˜ãPOSTï¼‰
  const addFavorite = async (recipe: Recipe) => {
      // Firebaseã®currentUserã‹ã‚‰IDãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
      const auth = getAuth();
      const user = auth.currentUser;

      if (!user) {
       // æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ â†’ tryã«å…¥ã‚Œãšã“ã“ã§å®Œçµ
       setPopupMessage('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„');
       setAutoClose(true);
       setTimeout(() => {
         router.push('/login');
       }, 3000);
       return;
    }

  // èªè¨¼æ¸ˆã¿ â†’ ã“ã“ã‹ã‚‰try
  setIsSubmitting(true);
  try {
    const idToken = await user.getIdToken();

      // èªè¨¼ä»˜ãã§fetch
      const response = await fetch('http://localhost:8000/api/favorites', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${idToken}`,
        },
        body: JSON.stringify({
          title: recipe.title,
          content: recipe.instructions,
        }),
      });

  if (response.ok) {
        // æˆåŠŸæ™‚
        setPopupMessage('ç™»éŒ²ã§ãã¾ã—ãŸï¼');
        setAutoClose(true);
        setTimeout(() => {
          router.push('/favorites');
        }, 3000);
      } else if (response.status === 409) {
        // é‡è¤‡æ™‚
        setPopupMessage('ç™»éŒ²æ¸ˆã¿ã§ã™');
        setAutoClose(false); // OKãƒœã‚¿ãƒ³ã§é–‰ã˜ã‚‹
      } else {
        const errorData = await response.json();
        throw new Error(`ãŠæ°—ã«å…¥ã‚Šç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ (${response.status}): ${errorData.detail}`);
      }
    } catch (error) {
      console.error('ã‚¨ãƒ©ãƒ¼:', error);
      setError((error as Error).message);
    } finally {
      setIsSubmitting(false);
    }
  };    

  return (
    <div className="min-h-screen bg-white font-sans p-8 flex flex-col items-center gap-6">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <div className="w-full flex justify-end">
        <LoginMenuButton />
      </div>

     {/* ä¸­å¤®æƒãˆéƒ¨åˆ†ï¼ˆh1 ï¼‹ ãƒ•ã‚©ãƒ¼ãƒ  ï¼‹ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ï¼‹ ãƒªã‚¹ãƒˆï¼‰ */}
      <div className="flex flex-col items-center w-full max-w-md text-center space-y-6">
        <h1 className="text-3xl font-bold text-[#443627]">ä»Šæ—¥ãªã«ã¤ãã‚‹ï¼Ÿ</h1>

     {/* æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  */}
      <RecipeForm onSearch={handleSearch} />

     {loading && <p>èª­ã¿è¾¼ã¿ä¸­...</p>}
     {error && <p className="text-red-500">{error}</p>}

    {/* ãƒ¬ã‚·ãƒ”ãƒªã‚¹ãƒˆ */}
      <RecipeList
        recipes={recipes}
        addFavorite={addFavorite}
        isSubmitting={isSubmitting}
      />
    </div>
      
      {/* â˜…â˜…â˜… ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º */}
      {popupMessage && (
        <PopupMessage
          message={popupMessage}
          onClose={closePopup}
          autoClose={autoClose}
          autoCloseDelay={3000}
        />
      )}
    </div>
  );
}
</file>

<file path="frontend/package.json">
{
  "name": "next",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "prettier": "prettier --write .",
    "lint": "eslint . --fix",
    "build": "next build",
    "start": "next start",
    "test": "vitest"
  },
  "dependencies": {
    "firebase": "^11.8.1",
    "next": "15.3.3",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "react-firebase-hooks": "^5.1.1",
    "react-hot-toast": "^2.5.2"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3.0.0",
    "@testing-library/jest-dom": "^6.6.3",
    "@testing-library/react": "^16.3.0",
    "@testing-library/user-event": "^14.6.1",
    "@types/node": "^20.0.0",
    "@types/react": "^19.0.0",
    "@types/react-dom": "^19.0.0",
    "@typescript-eslint/eslint-plugin": "^6.13.1",
    "@typescript-eslint/parser": "^6.13.1",
    "autoprefixer": "^10.4.21",
    "eslint": "^8.56.0",
    "eslint-config-airbnb": "^19.0.4",
    "eslint-config-airbnb-typescript": "^17.1.0",
    "eslint-config-next": "^15.3.3",
    "eslint-config-prettier": "^9.1.0",
    "eslint-import-resolver-typescript": "^4.4.1",
    "eslint-plugin-import": "^2.31.0",
    "eslint-plugin-jsx-a11y": "^6.7.1",
    "eslint-plugin-prettier": "^5.0.1",
    "eslint-plugin-react": "^7.33.2",
    "eslint-plugin-react-hooks": "^4.6.0",
    "jsdom": "^26.1.0",
    "postcss": "^8.5.4",
    "prettier": "^3.2.5",
    "tailwindcss": "^3.4.17",
    "typescript": "^5.3.3",
    "vitest": "^3.1.4"
  }
}
</file>

</files>
